<!DOCTYPE html>
<html lang="en">

<head>
  <title>
  ICS 笔记3 · Oyyko
</title>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">




<meta name="author" content="Oyyko">
<meta name="description" content="ICS笔记3">
<meta name="keywords" content="blog,developer,personal">

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="ICS 笔记3"/>
<meta name="twitter:description" content="ICS笔记3"/>

<meta property="og:title" content="ICS 笔记3" />
<meta property="og:description" content="ICS笔记3" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://oyyko.com/posts/ics3/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-12-19T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-08-01T12:18:15+08:00" />




<link rel="canonical" href="https://oyyko.com/posts/ics3/">


<link rel="preload" href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="/css/coder.min.7fd036b343cb6d4fc2e47efe3b1a5c406158040064f1b42b81454ec5b7e3b70a.css" integrity="sha256-f9A2s0PLbU/C5H7&#43;OxpcQGFYBABk8bQrgUVOxbfjtwo=" crossorigin="anonymous" media="screen" />






  
    
    
    <link rel="stylesheet" href="/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css" integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin="anonymous" media="screen" />
  



 




<link rel="icon" type="image/svg+xml" href="/images/favicon.svg" sizes="any">
<link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16">

<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">









</head>






<body class="preload-transitions colorscheme-auto">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="/">
      Oyyko
    </a>
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link" href="/posts/">Blog</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="/about/">About</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="/projects/">Projects</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="https://oyyko.com/posts/ics3/">
              ICS 笔记3
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa fa-calendar" aria-hidden="true"></i>
              <time datetime="2021-12-19T00:00:00Z">
                2021-12-19
              </time>
          </div>
          
          
          <div class="tags">
  <i class="fa fa-tag" aria-hidden="true"></i>
    <span class="tag">
      <a href="/tags/ics/">ICS</a>
    </span></div>

        </div>
      </header>

      <div class="post-content">
        
        
        <hr>
        <i class="fa fa-book"></i> Table of Contents
               <div id="toc"> <nav id="TableOfContents">
  <ul>
    <li><a href="#chapter8-1-subroutines">Chapter8-1 Subroutines</a>
      <ul>
        <li><a href="#adt-abstract-data-types">ADT Abstract Data Types</a></li>
        <li><a href="#subroutine">Subroutine</a></li>
        <li><a href="#相关的指令">相关的指令</a></li>
        <li><a href="#jsr">JSR</a></li>
        <li><a href="#jsrr">JSRR</a></li>
        <li><a href="#ret">RET</a></li>
        <li><a href="#例子取负数">例子：取负数</a></li>
        <li><a href="#如何使用">如何使用</a></li>
        <li><a href="#调用时的信息传递">调用时的信息传递</a></li>
        <li><a href="#caller-save-and-caller-save">caller-save and caller-save</a></li>
      </ul>
    </li>
    <li><a href="#chapter8-2-memory-model-for-program-execution--the-stack">Chapter8-2 Memory Model for Program Execution &amp; the Stack</a></li>
  </ul>
</nav> </div>
        <hr>
        <p>ICS笔记3</p>
<h2 id="chapter8-1-subroutines">
  Chapter8-1 Subroutines
  <a class="heading-link" href="#chapter8-1-subroutines">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<h3 id="adt-abstract-data-types">
  ADT Abstract Data Types
  <a class="heading-link" href="#adt-abstract-data-types">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>Up to now, we have processed a single value</p>
<ul>
<li>an integer</li>
<li>a floating point number, or</li>
<li>an ASCII character</li>
</ul>
<p>The real world is <strong>abstract data types</strong>, or more colloquially data structures，far more complex than simple, single numbers. E.g.</p>
<ul>
<li>a company’s organization chart</li>
<li>a list of items arranged in alphabetical order</li>
</ul>
<p>In this chapter, we will study three abstract data types:</p>
<ul>
<li>stacks</li>
<li>queues</li>
<li>and character strings</li>
</ul>
<p>Before we get to stacks, queues, and character strings, however, we introduce a new concept that will prove very useful in manipulating data structures: <strong>subroutines, or what is also called functions</strong>.</p>
<h3 id="subroutine">
  Subroutine
  <a class="heading-link" href="#subroutine">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>A subroutine is a program fragment that. . .</p>
<ul>
<li>Resides in user space (i.e, not in OS)</li>
<li>Performs a well-defined task</li>
<li>Is invoked (called) multiple times by a user program</li>
<li>Returns control to the calling program when finished</li>
</ul>
<p>Virtues:</p>
<ul>
<li>Reuse code without re-typing it (and debugging it!)</li>
<li>Divide task into parts (or among multiple programmers)</li>
<li>Use vendor-supplied library of useful routines that one software engineer writes a program that requires such fragments and another software engineer writes the fragments.
<ul>
<li>math library</li>
<li>square root, sine, and arctangent,etc.</li>
</ul>
</li>
</ul>
<p>Important: <strong>The Call/Return Mechanism</strong></p>
<h3 id="相关的指令">
  相关的指令
  <a class="heading-link" href="#%e7%9b%b8%e5%85%b3%e7%9a%84%e6%8c%87%e4%bb%a4">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>JSR,JSRR,RET</p>
<h3 id="jsr">
  JSR
  <a class="heading-link" href="#jsr">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>0100 1 PCoffset11
作用：跳转，并且把之前的PC保存在R7</p>
<h3 id="jsrr">
  JSRR
  <a class="heading-link" href="#jsrr">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>0100 0 00 BaseR 000000
作用：根据BaseR的值跳转，并且把PC的值保存在R7</p>
<h3 id="ret">
  RET
  <a class="heading-link" href="#ret">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>1100 000 111 000000
作用：把R7的值赋给PC</p>
<h3 id="例子取负数">
  例子：取负数
  <a class="heading-link" href="#%e4%be%8b%e5%ad%90%e5%8f%96%e8%b4%9f%e6%95%b0">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1</span><span>Negate NOT R0,R0
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2</span><span>ADD R0,R0,#<span style="color:#2aa198">1</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3</span><span>RET 
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1</span><span>; call the subroutine to compute R4<span style="color:#719e07">=-</span>R3
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2</span><span>AND R0,R0,#<span style="color:#2aa198">0</span> ; let R0<span style="color:#719e07">=</span><span style="color:#2aa198">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3</span><span>ADD R0,R0,R3 ; let R0<span style="color:#719e07">=</span>R3
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">4</span><span>JSR Negate
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">5</span><span>AND R4,R4,#<span style="color:#2aa198">0</span> ; let R4<span style="color:#719e07">=</span><span style="color:#2aa198">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">6</span><span>ADD R4,R4,R0 
</span></span></code></pre></div><h3 id="如何使用">
  如何使用
  <a class="heading-link" href="#%e5%a6%82%e4%bd%95%e4%bd%bf%e7%94%a8">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>Programmer must know</p>
<ul>
<li>Address: or at least a label that will be bound to its address</li>
<li>Function: what it does
<ul>
<li>NOTE: The programmer does not need to know how the subroutine works, but what changes are visible in the machine’s state after the routine has run</li>
</ul>
</li>
<li>Arguments: what they are and where they are placed</li>
<li>Return values: what they are and where they are placed</li>
</ul>
<h3 id="调用时的信息传递">
  调用时的信息传递
  <a class="heading-link" href="#%e8%b0%83%e7%94%a8%e6%97%b6%e7%9a%84%e4%bf%a1%e6%81%af%e4%bc%a0%e9%80%92">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>Argument(s)</p>
<ul>
<li>Value passed in to a subroutine is called an argument</li>
<li>This is a value needed by the subroutine to do its job</li>
<li>Examples</li>
<li>TwosComp: R0 is number to be negated</li>
<li>OUT: R0 is character to be printed</li>
<li>PUTS: R0 is address of string to be printed</li>
</ul>
<p>传递方法：
How?
In registers (simple, fast, but limited number)
In memory (many, but awkward, expensive)
Both</p>
<p>寄存器和内存进行传递参数</p>
<p>Return Values</p>
<ul>
<li>A value passed out of a subroutine is called a return value</li>
<li>This is the value that you called the subroutine to compute</li>
</ul>
<p>How?
Registers, memory, or both
Single return value in register most common
通常，采用寄存器保存返回值</p>
<h3 id="caller-save-and-caller-save">
  caller-save and caller-save
  <a class="heading-link" href="#caller-save-and-caller-save">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>在调用和返回的过程中势必会对寄存器产生修改，那么如何分配保存与恢复现场的责任呢？
一般有两种办法：
caller-save和callee-save
即责任在谁？
caller-save要求调用者来保存相关的寄存器的信息，并且恢复现场。
callee-save要求被调用者来存在相关的信息并且恢复现场。</p>
<p>一般都采用callee-save，只有对于函数返回值R7采用的是caller-save</p>
<p>Generally use “callee-save” strategy, except for return values
Same as trap service routines
Save anything that subroutine alters internally that shouldn’t be visible when the subroutine returns
Restore incoming arguments to original values (unless overwritten by return value)</p>
<p>Remember
<strong>You MUST save R7 if you call any other subroutine or trap</strong>
Otherwise, you won’t be able to return!</p>
<h2 id="chapter8-2-memory-model-for-program-execution--the-stack">
  Chapter8-2 Memory Model for Program Execution &amp; the Stack
  <a class="heading-link" href="#chapter8-2-memory-model-for-program-execution--the-stack">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
      </div>


      <footer>
        


        
        
        <div class="comments">
    <script>
  
    let getTheme = window.localStorage && window.localStorage.getItem("colorscheme");
  
    getTheme = getTheme == null ? 'github-light' : getTheme;
    
    let theme = getTheme === 'dark' ? 'github-dark' : 'github-light';
    let s = document.createElement('script');
    s.src = 'https://utteranc.es/client.js';
    s.setAttribute('repo', 'oyyko\/utteranc-comments');
    s.setAttribute('issue-term', 'pathname');
    s.setAttribute('theme', theme);
    s.setAttribute('crossorigin', 'anonymous');
    s.setAttribute('async', '');
    document.querySelector('div.comments').innerHTML = '';
    document.querySelector('div.comments').appendChild(s);
  
    </script>
    </div>
        
        
      </footer>
    </article>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css"
    integrity="sha384-vKruj+a13U8yHIkAyGgK1J3ArTLzrFGBbBc0tDp4ad/EyewESeXE/Iv67Aj8gKZ0" crossorigin="anonymous">
  
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js"
    integrity="sha384-PwRUT/YqbnEjkZO0zZxNqcxACrXe+j766U2amXcgMg5457rve2Y7I6ZJSm2A0mS4" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js"
    integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"
    onload="renderMathInElement(document.body,
      {
        delimiters: [
          {left: '$$', right: '$$', display:true},
          {left: '$', right: '$', display:false},
          {left: '\\(', right: '\\)', display: false},
          {left: '\\[', right: '\\]', display: true}
        ]
      }
    );"></script>
  </section>

    </div>

    <footer class="footer">
  <link rel='stylesheet' type='text/css' href=http://fonts.googleapis.com/css?family&#61;Jetbrains&#43;Mono%7cRoboto&#43;Slab%7cNoto&#43;Sans&#43;SC%7c>


    <section class="container">
      ©
      
      2019 -
      
      2023
       Oyyko 
      ·
      
      Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> & <a
        href="https://github.com/luizdepra/hugo-coder/" target="_blank" rel="noopener">Coder</a> Modified by <a
        href="https://oyyko.com" target="_blank" rel="noopener">Oyyko </a>.
      
    </section>
</footer>
  </main>

  

  
  
  <script src="/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js" integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script>
  

  

  


  

  

  

  

  

  

  

  

  

  

  

  

  

  
</body>

</html>
